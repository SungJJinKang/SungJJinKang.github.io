---
layout: post
title:  "텍스쳐 압축을 위한 힘든 여정"
date:   2021-03-01
categories: Doom3
---

지금까지는 텍스쳐를 압축없이 png 그대로 가져다 써왔다. 언젠가는 텍스쳐 압축을 해야겠다는 생각은 하였는 데 때가 된 것 같다.   
텍스쳐 압축은 해본 적이 없어서 인터넷 검색을 통해서 대충 어떻게 할지 정하였다.   
간단하게 설명하자면 에디터 단계에서 각 게임 내에 사용되는 모든 텍스쳐를 DXT 포맷으로 압축 후 dds파일로 저장한다.   
그 후 모든 텍스쳐 파일들을 zip같은 압축알고리즘으로 한 데 묶어서 관리하기로 하였다. 게임 내 사용되는 텍스쳐가 그렇게 많지 않을 것 같아서 그냥 통으로 모든 텍스쳐를 한 곳에 압축하기로 하였다. ( 나중에 3D model로 이렇게 압축할 예정이다. )

압축을 에디터 단계에서 한 후 빌드에 넘기니 Compression time, speed는 중요하지 않았고 중요한건 Decompression Speed였다. 모든 압축 알고리즘을 실험해보기에는 귀찮아서 인터넷에 올라와있는 여러 벤치마크를 비교 후 Decompression Speed가 가장 빠르고 압축률도 적당한 알고르짐인 

여러 라이브러리를 연구하였지만 대부분의 dxt라이브러리들이 업데이트도 안되고
삽질을 너무 많이 했다. compressonator라는 amd에서 나온 라이브러리도 실험하고 sdl_image도 해보고, opengl의 ktx 포맷도 실험해보았다.   
너무 힘들었다. 여러 가지 라이브러리를 시험해보느라.   
결국에는 마이크로소프트에서 만든 DirextXTex를 사용하기로 하였다. 기본적으로 DirectX에서 사용하기 위해 개발되었지만 텍스쳐 압축 포맷은 OpenGL에서도 사용하니 상관없다. 마소 짱짱....     


처음에는 Compressonator라는 라이브러리를 사용하려 하였으나 업데이트도 되지 않았고 VS2019에서 빌드도 안되어 몇시간 동안 삽질만 하고 포기하였다.    
마이크로소프트에서 관리하는 DirectXTex도 보았다가 결국 OpenGL에서 밀고 있는 KTX 라는 포맷으로 정하였다. OpenGL에서 밀고있다보니 조금 더 적용하기 쉬울 것이라 생각했다.
DXT도 마소에서는 D3, D6 처럼 다른 이름으로 사용하는 것 처럼 보였다. 이런 것 때문에 너무 너무 고생을 많이 헀다.

